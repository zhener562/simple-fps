# パフォーマンス最適化ガイド

このドキュメントは、ゲームのパフォーマンスを向上させ、特定のネットワーク環境下で最適な体験を提供するためのチューニング方法についてまとめたものです。

## 1. ゲーム全体の滑らかさ（フレームレート）の向上

ゲームのフレームレート（FPS）は、主に描画負荷に影響されます。以下は、比較的簡単に試せて効果の高い最適化手法です。

### 影の描画を無効にする

**概要:**
シーン内の影の計算は、リアルタイムレンダリングにおいて最も負荷の高い処理の一つです。これを無効化することで、フレームレートを大幅に向上させることができます。

**修正方法:**
`static/index.tsx` ファイル内の `initThreeJSGame` 関数にある、以下の行を修正します。

- **変更前:** `renderer.shadowMap.enabled = true;`
- **変更後:** `renderer.shadowMap.enabled = false;`

**効果:**
- 全ての影がなくなり、シーンの見た目は少し平坦になりますが、GPU負荷が劇的に減少し、特にミドルスペックやロースペックのPCでのパフォーマンスが大きく改善されます。

---

## 2. ネットワーク対戦の最適化

P2P対戦における快適性は、操作の応答性と同期の正確性のバランスによって決まります。

### 入力遅延 (`INPUT_DELAY_MS`) の調整

**概要:**
`INPUT_DELAY_MS` は、相手プレイヤーとの操作タイミングを合わせるための人工的な遅延です。この値は、プレイヤー間のネットワーク遅延（Ping）に応じて調整するのが理想です。

#### インターネット対戦（デフォルト設定）

- **現在の設定値:** `50` (ミリ秒)
- **解説:** この値は、一般的なインターネット環境（Pingが30ms〜100ms程度）を想定した、非常にバランスの取れた設定です。多くのプレイヤーにとって快適なプレイを提供しつつ、同期ズレを防ぎます。基本的にはこの設定を変更する必要はありません。

#### LAN対戦（同一ネットワーク内でのプレイ）

**概要:**
同じネットワーク内（LAN環境）では、通信遅延が数ミリ秒と非常に小さいため、インターネット対戦用の大きな遅延は不要です。この値を下げることで、オフラインゲームのような極めて快適な操作性を実現できます。

**推奨設定:**
`static/index.tsx` ファイル内の以下の定数を変更します。

- **変更前:** `const INPUT_DELAY_MS = 50;`
- **変更後:** `const INPUT_DELAY_MS = 10;`

**効果:**
- 操作の反映が非常に速くなり、体感的なレスポンスが劇的に向上します。

**【重要事項】**
- この設定は、**対戦する全てのプレイヤーが同じ値に設定している必要があります。**
- 異なる値のプレイヤー同士が対戦すると、ゲームの同期が正常に行われません。
- 将来的に、UIに「LANモード」のようなオプションを追加し、対戦前に全員が同じ設定を有効にできるようにするのが望ましいです。
